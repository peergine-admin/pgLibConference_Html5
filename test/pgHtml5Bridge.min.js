var __IP_PORT__="127.0.0.1:17885";var __WS__URL__="ws://"+__IP_PORT__;var __WS_PARAM__="peergine-node";var __VERSION_URL__="http://"+__IP_PORT__+"/version";var __PING_URL__="http://"+__IP_PORT__+"/ping";var __ACTION_URL__="http://"+__IP_PORT__+"/peergine.do";var m_NodeList=new Array;var ws;var lockReconnect=false;var bCreateWSed=false;var __GENGRATE_VIEW_ID=1;function generateViewID(){return __GENGRATE_VIEW_ID++}function FindNode(e){for(var t=0;t<m_NodeList.length;t++){if(m_NodeList[t].sSession==e){return m_NodeList[t]}}return null}function createWebSocket(t,e){if(bCreateWSed==false){try{ws=new WebSocket(t,e);initEventHandle()}catch(e){reconnect(t)}}bCreateWSed=true}function initEventHandle(){ws.onclose=function(){reconnect(__WS__URL__,__WS_PARAM__);console.log("onclose")};ws.onerror=function(){reconnect(__WS__URL__,__WS_PARAM__);console.log("onerror")};ws.onopen=function(){heartCheck.reset();console.log("onopen");for(var e=0;e<m_NodeList.length;e++){var t="sSession:"+m_NodeList[e].sSession;try{ws.send(t)}catch(e){console.error("error = "+e);window.setTimeout(function(){TimeoutWSSendSession(t)},100)}}};ws.onmessage=function(e){heartCheck.reset();if(e.data!="HeartBeat"){var t=decodeURIComponent(e.data);var s=JSON.parse(t);var n=FindNode(s.sSession);if(n!=null){if(s.OnFun=="OnExtRequest"){if(n.OnExtRequest!=null){var o=s.sObj;var r=s.uMeth;var i=s.sData;var a=s.uHandle;var _=s.sPeer;console.log("sObj: "+o+" uMeth: "+r+" sData: "+i+" uHandle: "+a+" sPeer: "+_);n.OnExtRequest(o,r,i,a,_)}}else if(s.OnFun=="OnReply"){if(n.OnReply!=null){var o=s.sObj;var u=s.uErr;var i=s.sData;var c=s.sParam;console.log("sObj: "+o+" uErr: "+u+" sData: "+i+" sParam: "+c);n.OnReply(o,u,i,c)}}else{console.log("string js = "+t)}}else{console.error("can't found node sSession error")}}else{console.log("HeartBeat reply!")}}}function reconnect(e,t){if(lockReconnect){return}lockReconnect=true;setTimeout(function(){createWebSocket(e,t);lockReconnect=false},2e3)}var heartCheck={timeout:5e3,serverTimeout:8e3,timeoutObj:null,serverTimeoutObj:null,reset:function(){clearTimeout(heartCheck.timeoutObj);clearTimeout(heartCheck.serverTimeoutObj);heartCheck.start()},start:function(){heartCheck.timeoutObj=setTimeout("heartCheck.send()",heartCheck.timeout)},send:function(){ws.send("HeartBeat");heartCheck.serverTimeoutObj=setTimeout("heartCheck.sendTimeout()",heartCheck.serverTimeout)},sendTimeout:function(){ws.close()}};createWebSocket(__WS__URL__,__WS_PARAM__);function TimeoutWSSendSession(t){try{ws.send(t)}catch(e){console.error("error = "+e);window.setTimeout(function(){TimeoutWSSendSession(t)},100)}}function pgLibJSNode(e){this.Control="";this.Node="";this.Class="";this.Local="";this.Server="";this.Relay="";this.OnExtRequest=null;this.OnReply=null;this.sSession=e;m_NodeList.push(this);createWebSocket(__WS__URL__,__WS_PARAM__);this.ObjectAdd=function(e,t,s,n){var o={sObject:e,sClass:t,sGroup:s,uFlag:n};var r="method=ObjectAdd"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(o));return GetFunRes(__ACTION_URL__,r)};this.ObjectDelete=function(e){var t={sObject:e};var s="method=ObjectDelete"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(t));return GetFunRes(__ACTION_URL__,s)};this.ObjectGetClass=function(e){var t={sObject:e};var s="method=ObjectGetClass"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(t));return GetFunRes(__ACTION_URL__,s)};this.ObjectSetGroup=function(e,t){var s={sObject:e,sGroup:t};var n="method=ObjectSetGroup"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(s));return GetFunRes(__ACTION_URL__,n)};this.ObjectGetGroup=function(e){var t={sObject:e};var s="method=ObjectGetGroup"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(t));return GetFunRes(__ACTION_URL__,s)};this.ObjectSync=function(e,t,s){var n={sObject:e,sPeer:t,uAction:s};var o="method=ObjectSync"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(n));return GetFunRes(__ACTION_URL__,o)};this.ObjectRequest=function(e,t,s,n){var o={sObject:e,uMeth:t,sIn:s,sParam:n};var r="method=ObjectRequest"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(o));return GetFunRes(__ACTION_URL__,r)};this.ObjectExtReply=function(e,t,s,n){var o={sObject:e,uErr:t,sOut:s,uHandle:n};var r="method=ObjectExtReply"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(o));return GetFunRes(__ACTION_URL__,r)};this.ObjectEnum=function(e,t){var s={sObject:e,sClass:t};var n="method=ObjectEnum"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(s));return GetFunRes(__ACTION_URL__,n)};this.PostMessage=function(e){var t={sMsg:e};var s="method=ObjectEnum"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(t));return GetFunRes(__ACTION_URL__,s)};this.Start=function(e){var t="sSession:"+this.sSession;window.setTimeout(function(){TimeoutWSSendSession(t)},100);var s={uOption:e,Control:this.Control,Node:this.Node,Class:this.Class,Local:this.Local,Server:this.Server,Relay:this.Relay};var n="method=Start"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(s));return GetFunRes(__ACTION_URL__,n)};this.Stop=function(){var e={};var t="method=Stop"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(e));GetFunRes(__ACTION_URL__,t)};this.omlEncode=function(e){var t={sEle:e};var s="method=omlEncode"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(t));return GetFunRes(__ACTION_URL__,s)};this.omlDecode=function(e){var t={sEle:e};var s="method=omlDecode"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(t));return GetFunRes(__ACTION_URL__,s)};this.omlSetName=function(e,t,s){var n={sEle:e,sPath:t,sName:s};var o="method=omlSetName"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(n));return GetFunRes(__ACTION_URL__,o)};this.omlSetClass=function(e,t,s){var n={sEle:e,sPath:t,sClass:s};var o="method=omlSetClass"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(n));return GetFunRes(__ACTION_URL__,o)};this.omlSetContent=function(e,t,s){var n={sEle:e,sPath:t,sContent:s};var o="method=omlSetContent"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(n));return GetFunRes(__ACTION_URL__,o)};this.omlNewEle=function(e,t,s){var n={sName:e,sClass:t,sContent:s};var o="method=omlNewEle"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(n));return GetFunRes(__ACTION_URL__,o)};this.omlGetEle=function(e,t,s,n){var o={sEle:e,sPath:t,uSize:s,uPos:n};var r="method=omlGetEle"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(o));return GetFunRes(__ACTION_URL__,r)};this.omlDeleteEle=function(e,t,s,n){var o={sEle:e,sPath:t,uSize:s,uPos:n};var r="method=omlDeleteEle"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(o));return GetFunRes(__ACTION_URL__,r)};this.omlGetName=function(e,t){var s={sEle:e,sPath:t};var n="method=omlGetName"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(s));return GetFunRes(__ACTION_URL__,n)};this.omlGetClass=function(e,t){var s={sEle:e,sPath:t};var n="method=omlGetClass"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(s));return GetFunRes(__ACTION_URL__,n)};this.omlGetContent=function(e,t){var s={sEle:e,sPath:t};var n="method=omlGetContent"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(s));return GetFunRes(__ACTION_URL__,n)};this.WndCreate=function(e){var t=document.getElementById(e);if(t!=null){console.log("divID = "+e);var s=-1;var n=document.getElementById(e+"_img");if(n==null){n=document.createElement("img");t.appendChild(n);s=generateViewID();t.setAttribute("ViewID",s);t.setAttribute("NodeSess",this.sSession);t.setAttribute("Count",0);n.id=e+"_img";n.style="width:100%;height:100%;margin:0px;display:block;overflow:hidden;";n.setAttribute("onload","_pgView.imgonload('"+e+"')");n.setAttribute("onerror","_pgView.imgonerror('"+e+"')");window.setTimeout(function(){_pgView.imgload(e)},10)}else{s=t.getAttribute("ViewID")}var o=this.sSession>>16|s<<16;var r="(PosX){0}(PosY){0}(SizeX){"+320+"}(SizeY){"+240+"}(Handle){"+o+"}";console.log("sWnd = "+r);return r}return""};this.WndDestroy=function(e){var t=document.getElementById(e);if(t!=null){var s=document.getElementById(e+"_img");if(s!=null){s.id="";t.removeChild(s)}}};this.utilCmd=function(e,t){var s={sCmd:e,sParam:t};var n="method=utilCmd"+"&sSession="+this.sSession+"&sParam="+encodeURIComponent(JSON.stringify(s));return GetFunRes(__ACTION_URL__,n)}}function pgJSNodeVersion(){return GetFunRes1(__VERSION_URL__,"")}function pgNewJSNode(e){var t=parseInt(65535*Math.random());var s=e<<16|t;var n="method=pgNewJSNode&sSession="+s;var o=GetFunRes(__ACTION_URL__,n);var r=new pgLibJSNode;r.sSession=o;return r}function pgDeleteJSNode(e){if(e!=null&&typeof e.sSession!="undefined"){var t="method=pgDeleteJSNode&sSession="+e.sSession;return GetFunRes(__ACTION_URL__,t)}return""}function GetXmlHttpObject(){var t=null;try{t=new XMLHttpRequest}catch(e){try{t=new ActiveXObject("Msxml2.XMLHTTP")}catch(e){t=new ActiveXObject("Microsoft.XMLHTTP")}}return t}function GetFunRes1(e,t){var s=GetXmlHttpObject();s.open("GET",e,false);s.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=utf-8");try{s.send(t)}catch(e){console.error("xmlhttp.send = "+e)}var n=s.responseText;return n}function GetFunRes(e,t){var s=GetXmlHttpObject();s.open("POST",e,false);s.setRequestHeader("Content-type","application/x-www-form-urlencoded;charset=utf-8");try{s.send(t)}catch(e){console.error("xmlhttp.send = "+e)}var n=s.responseText;return n}function datuIMG(e,t,s){e.width=t;e.height=s;e.style.padding="0px"}function AutoResizeImage(e,t,s){var n=new Image;n.src=s.src;var o;var r;var i=1;var a=n.width;var _=n.height;r=e/a;o=t/_;if(e==0&&t==0){i=1}else if(e==0){if(o<1)i=o}else if(t==0){if(r<1)i=r}else if(r<1||o<1){i=r<=o?r:o}if(i<1){a=a*i;_=_*i}s.height=_;s.width=a}function _PG_VIEW(){var e=null;var t=null;var s=null;var n=-1;var o=-1;var r=null;var i=0}var _pgView={url:"http://"+__IP_PORT__+"/video.do",_PG_VIEW_LIST:new Array,imgload:function(e){var t=document.getElementById(e);if(t){var s=document.getElementById(e+"_img");var n=t.getAttribute("ViewID");var o=t.getAttribute("NodeSess");var r=t.getAttribute("Count");if(s){s.src=_pgView.url+"/Session"+o+"/ViewID"+n+"/Count"+r}}},imgonload:function(e){var t=document.getElementById(e);if(t){var s=document.getElementById(e+"_img");datuIMG(s,t.offsetWidth,t.offsetHeight);t.setAttribute("Count",parseInt(t.getAttribute("Count"))+1);window.setTimeout(function(){_pgView.imgload(e)},1)}},imgonerror:function(e){var t=document.getElementById(e);if(t){var s=document.getElementById(e+"_img");datuIMG(s,t.offsetWidth,t.offsetHeight);t.setAttribute("Count",parseInt(t.getAttribute("Count"))+1);window.setTimeout(function(){_pgView.imgload(e)},1)}return false}};